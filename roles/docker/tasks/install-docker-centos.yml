---
- name: Install requirements.
  yum: name={{ item }} state=present
  with_items: "{{ requirements }}"

- name: Remove any old docker versions.
  package:
    name: '{{ item }}'
    state: absent
  with_items:
    - docker
    - docker-common
    - docker-engine

- name: Add Docker GPG key.
  rpm_key:
    key: https://download.docker.com/linux/centos/gpg
    state: present

- name: Add Docker repository.
  get_url:
    url: "{{ docker_yum_repo_url }}"
    dest: '/etc/yum.repos.d/docker-{{ docker_edition }}.repo'
    owner: root
    group: root
    mode: 0644 

- name: Enable/Disable Docker Edge repo.
  ini_file:
    dest: '/etc/yum.repos.d/docker-{{ docker_edition }}.repo'
    section: 'docker-{{ docker_edition }}-edge'
    option: enabled
    value: '{{ docker_yum_repo_enable_edge }}'

- name: Enable/Disable Docker Test repo.
  ini_file:
    dest: '/etc/yum.repos.d/docker-{{ docker_edition }}.repo'
    section: 'docker-{{ docker_edition }}-test'
    option: enabled
    value: '{{ docker_yum_repo_enable_test }}'

# Install requirements
# - name: Install yum-utils
#   yum:
#     name: yum-utils
#     state: present

# - name: Install device-mapper-persistent-data
#   yum:
#     name: device-mapper-persistent-data
#     state: present

# - name: Install lvm2
#   yum:
#     name: lvm2
#     state: present

# - name: Add docker repo
#   yum_repository:
#     name: docker-ce
#     description: docker-ce
#     baseurl: "{{ docker_repository_url_centos }}"
#     gpgcheck: no

# Install Docker CE
# - name: Install docker ce
#   yum:
#     name: docker-ce
#     disable_gpg_check: yes
#     state: present

# - name: Update yum cache
#   command: sudo yum check-update
#   ignore_errors: yes

# - name: Download docker and install
#   become: true
#   command: curl -fsSL https://get.docker.com/ | sh

# # Enable docker autostart
# - name: Set docker container service autostart to enabled
#   command: echo "Set docker container service autostart to enabled"
#   notify:
#     - enable autostart docker
#   when: docker_autostart

# - name: Make sure docker container service is started
#   command: echo "Starting docker container service"
#   notify:
#     - start docker container service

# - name: Execute handlers before verifying docker installation
#   meta: flush_handlers

# - name: Verify docker installation
#   command: docker run hello-world
#   register: docker_output

# - debug:
#     var: docker_output.stdout_lines